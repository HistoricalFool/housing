
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      Stata 18.0
___/   /   /___/   /   /___/       BE—Basic Editio
> n

 Statistics and Data Science       Copyright 1985-
> 2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Dr
> ive
                                   College Station
> , Texas 77845 USA
                                   800-782-8272   
>      https://www.stata.com
                                   979-696-4600   
>      service@stata.com

Stata license: Single-user  perpetual
Serial number: 301806304604
  Licensed to: tate
               UGA

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help
          unicode_advice.

. do extension.do 

. /***********************************************
> ******************************* 
> * Stata program:        extension_data_create
> * --------------
> *
> * Author:                       Tate Mason, UNCC
> , dmason27@uncc.edu
> * -------
> *
> * Date:                         02/25/2024 
> * -----
> *
> ************************************************
> ******************************/
.         
.         /***************************************
> ************************** (1) Setup basic stata
>  environment variables
>         ****************************************
> *************************/
. 
.                 #delimit cr             // make 
> carriage return the command delimiter
delimiter now cr
.                 clear                           
> //clear data in memory

.                 clear all                       
> //clear all variables in memory

.                 set more off            //turn t
> he "more" option for screen output off

. 
.                 local rootPath "/Volumes/TD1/mas
> on/housing/"

.                 
.                 local codePath "`rootPath'/RM2 C
> ode"

.                 local dataPath "`rootPath'/RM2-D
> ata"

.                 local outputPath "`rootPath'/out
> put"

.                 
.                 
.                 
.                 //local rawDataPath "/Volumes/El
> ements/data/Census"
.                 
. 
.                 cap log close

.                 //log using `outputPath'extensio
> n_data_create.txt, replace
.         
.         
.                 
.         /***************************************
> **************************
>         * (1) Prepare and collapse IPUMS-USA Dat
> a
>         ****************************************
> *************************/
.                 
.                         
.                 local readRaw 1

.                 if `readRaw' {
.                 
.                         use "`dataPath'/usa_0003
> 5.dta", clear //with education and occ
.                         keep if inlist(gq,1,2,5)
>  //drop peopel in group quarters
(2,867,390 observations deleted)
.                         
.                         /*
>                         INCTOT Specific Variable
>  Codes 
>                         -009995 = -$9,900 (1980)
>  
>                         -000001 = Net loss (1950
> ) 
>                         0000000 = None 
>                         0000001 = $1 or break ev
> en (2000, 2005-onward ACS and PRCS) 
>                         9999999 = N/A
>                         
>                         */
.                         
.                         local vars "inctot"
.                         foreach v of local vars 
> {
  2.                                 replace `v' =
>  . if inlist(`v',-009995,-000001,0000001,0000000
> ,9999999)
  3.                         }
(23,147,184 real changes made, 23,147,184 to missi
> ng)
.                         
.                         /*
>                         //deal with top coded va
> lues
>                         //use David Autor's meth
> od from: Trends in U.S. Wage Inequality: Revisin
> g the Revisionists
>                         David H. Autor, Lawrence
>  F. Katz and Melissa S. Kearney
>                         Review of Economics and 
> Statistics, May 2008.
>                         
>                         
>                                 INCTOT
>                                 Census  Bottom C
> ode     Top Code
>                                 1950    Net loss
>         $10,000
>                                 1960    -$9,900 
> $25,000
>                                 1970    -$9,900 
> $50,000
>                                 1980    -$9,990 
> $75,000
>                                 
>                                 1990    -$19,998
>          $400,000* //already corrected
>                                 
>                                 2000    -$20,000
>         $999,998
>                                 ACS     -$19,998
>         -
>                                 PRCS    -$19,998
>         -
> 
>                         
>                         */
.                         
.                         /*
>                         INCWAGE Specific Variabl
> e Codes 
>                         999999 = N/A 
>                         999998 = Missing
>                         */
.                         
.                         
.                         local vars "incwage"
.                         foreach v of local vars 
> {
  2.                                 replace `v' =
>  . if inlist(`v',999999,999998)
  3.                         }
(16,256,507 real changes made, 16,256,507 to missi
> ng)
.                         
.                         /*      
>                         
>                         //deal with top coded va
> lues
>                                 //use David Auto
> r's method from: Trends in U.S. Wage Inequality:
>  Revising the Revisionists
>                                 David H. Autor, 
> Lawrence F. Katz and Melissa S. Kearney
>                                 Review of Econom
> ics and Statistics, May 2008.
>                                 
>                                 They windsorize 
> by multiplying by 1.5
>                         
>                                 INCWAGE
>                                 Census  Top Code
>                                 1940    $5,001
>                                 1950    $10,000
>                                 1960    $25,000
>                                 1970    $50,000
>                                 1980    $75,000
>                                 
>                                 1990     $140,00
> 0*
>                                 2000      $175,0
> 00**
>                                 ACS (2000-2002) 
>   $200,000**
>                                 ACS (2003-onward
> )        99.5th Percentile in State**
>                                  PRCS (2005-onwa
> rd)      99.5th Percentile in State**
>                         
>                         */
.                         
.                         /*
>                         FTOTINC Specific Variabl
> e Codes 
>                         -000001 = Net loss (1950
> ) 
>                         0000000 = No income (195
> 0-2000, ACS/PRCS) 
>                         9999998 = Not ascertaine
> d (1950) 
>                         9999999 = N/A
>                         */
.                         
.                         local vars "ftotinc"
.                         foreach v of local vars 
> {
  2.                                 replace `v' =
>  . if inlist(`v',-000001,0000000,9999998,9999999
> )
  3.                         
.                         }
(987,897 real changes made, 987,897 to missing)
.                         
.                                         
.                         
.                         /*
>                         INCOTHER Specific Variab
> le Codes 
>                         -0001 = Net loss (1950) 
>                         99999 = N/A
>                         
>                         */
.                         
.                         local vars "incother"
.                         foreach v of local vars 
> {
  2.                                 replace `v' =
>  . if inlist(`v',-0001,99999)
  3.                         }
(15,466,549 real changes made, 15,466,549 to missi
> ng)
.                         
.                         /***********************
> ******************************************
>                         * Business/Farm Income: 
> This is income from non-incorporated
>                         * business activities. T
> his includes "self employemnt". If the
>                         * business is incorporat
> ed, then the income is supposed to be
>                         * counted in incwage, ev
> en if the person has an ownership stake.
>                         ************************
> *****************************************/
.                         
.                         
.                                 /*
>                                 INCBUS Specific 
> Variable Codes 
>                                 -09995 = -$9,900
>  (1970) 
>                                 999999 = N/A
>                                 
>                                 */
.                                 
.                                 local vars "incb
> us"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',-09995,999999)
  3.                                 }
(1,083,227 real changes made, 1,083,227 to missing
> )
.                                 
.                         
.                                 /*
>                                 INCFARM Specific
>  Variable Codes 
>                                 -09995 = -$9,990
>  (1980) 
>                                 999999 = N/A
>                                 */
.                                 
.                                 local vars "incf
> arm"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',-09995,999999)
  3.                                 }
(1,083,227 real changes made, 1,083,227 to missing
> )
.                                 
.                                 /*
>                                 INCBUS00 Specifi
> c Variable Codes 
>                                 000001 = $1 or b
> reak even (2000, 2005-2007 ACS) 
>                                 999999 = N/A
>                                 */
.                                 
.                                 local vars "incb
> us00"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',999999)
  3.                                 }
(14,383,322 real changes made, 14,383,322 to missi
> ng)
.                                 
.                                 /***************
> ************************************************
> **
>                                 * Harmonized bus
> iness/farm income variable
>                                 * See: https://u
> sa.ipums.org/usa-action/variables/INCTOT#compara
> bility_section
>                                 ****************
> ************************************************
> */
.                                         
.                                         local va
> rs "incbus incfarm incbus00"
.                                         
.                                         foreach 
> v of local vars {
  2.                                              
>    
.                                                 
> rename `v' raw_`v'
  3.                                              
>    
.                                         }
.                                                 
>         
.                                         gen incb
> us = . 
(79,154,500 missing values generated)
.                                         label va
> riable incbus "Harmonized Business/Farm Income"
.                                                 
.                                         replace 
> incbus = raw_incbus+raw_incfarm if inlist(year,1
> 970,1980,1990)
(2,860,672 real changes made)
.                                         replace 
> incbus = raw_incbus00 if year>=2000
(60,827,279 real changes made)
.                                 
.                                         
.                                         
.                         /***********************
> ******************************************
>                         * Transfers
>                         ************************
> *****************************************/
.                         
.                         
.                                 /*
>                                 INCWELFR Specifi
> c Variable Codes 
>                                 99999 = N/A
>                                 */
.                                 
.                                 local vars "incw
> elfr"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',99999)
  3.                                 }
(15,466,549 real changes made, 15,466,549 to missi
> ng)
.                                 
.                                 /*
>                                 INCSUPP Specific
>  Variable Codes 
>                                 99999 = N/A
>                                 */
.                                 local vars "incs
> upp"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',99999)
  3.                                 }
(14,383,322 real changes made, 14,383,322 to missi
> ng)
.                         
.                         /***********************
> ******************************************
>                         * Investment Income
>                         ************************
> *****************************************/
.                         
.                         
.                                 /*
>                                 INCINVST Specifi
> c Variable Codes 
>                                 -09995 = -$9,990
>  (1980) 
>                                 000001 = $1 or b
> reak even (1990, 2000, ACS, PRCS) 
>                                 999999 = N/A
>                                 */
.                                 /*
>                                 local vars "inci
> nvst"
>                                 foreach v of loc
> al vars {
>                                         replace 
> `v' = . if inlist(`v',-09995,999999)
>                                 }
>                           */
.                         /***********************
> ******************************************
>                         * Retirement Income
>                         ************************
> *****************************************/
.                         
.                                 /*
>                                 INCSS Specific V
> ariable Codes 
>                                 99999 = N/A
>                                 */      
.                                 
.                                 local vars "incs
> s"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',99999)
  3.                                 }
(15,466,549 real changes made, 15,466,549 to missi
> ng)
.                                 
.                                 /*
>                                 INCRETIR Specifi
> c Variable Codes 
>                                 999999 = N/A
>                                 */
.                                 
.                                 local vars "incr
> etir"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',99999)
  3.                                 }
(0 real changes made)
.                         
.                         //income not from wages 
> or business
.                         
.                                 rename incother 
> raw_incother
.                                 
.                                 gen incother = i
> nctot - incwage - incbus
(23,278,558 missing values generated)
.                                 label variable i
> ncother "Income not from wages or business/farm"
.                         
.                         
.                         /***********************
> ******************************************
>                         * House Values
>                         ************************
> *****************************************/
.                         
.                         
.                                 /*
>                                 VALUEH Specific 
> Variable Codes 
>                                 0000000 = N/A (1
> 930) 
>                                 9999998 = Missin
> g (1940 100%) 
>                                 9999999 = Missin
> g (1930), N/A (1940-2000, ACS, and PRCS)
>                                 */      
.                                 
.                                 local vars "valu
> eh"
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',9999998,9999999,0000000
> )
  3.                                 }
(22,150,352 real changes made, 22,150,352 to missi
> ng)
.                         
.                         
.                         /***********************
> ******************************************
>                         * Rent
>                         ************************
> *****************************************/
.                         
.                         
.                                 /*
>                                 RENT Specific Va
> riable Codes 
>                                 0000 = N/A 
>                                 0001 = No cash r
> ent (1980-1990) 
>                                 9998 = Missing (
> 1940) 
>                                 9999 = No cash r
> ent (1940)
>                                 */      
.                                 
.                                 local vars "rent
> "
.                                 foreach v of loc
> al vars {
  2.                                         repla
> ce `v' = . if inlist(`v',0000,0001,9998,9999)
  3.                                 }
(58,994,176 real changes made, 58,994,176 to missi
> ng)
.                                 
.                                 
.                         
.                         /***********************
> ******************************************
>                         * Demographic variables
>                         ************************
> *****************************************/
.                         
.                                 //race
.                                 recode race (4/6
> =1) (1/3 7/9=0), gen(asian)
(79,154,500 differences between race and asian)
.                                 
.                                 recode raced (40
> 0/420=1) (100/399 500/997=0), gen(chinese)
(79,154,500 differences between raced and chinese)
.                                 
.                                 recode raced (60
> 0=1) (100/500 610/997=0), gen(filipino)
(79,154,500 differences between raced and filipino
> )
.                                 
.                                 recode raced (61
> 0=1) (100/600 620/997=0), gen(indian)
(79,154,500 differences between raced and indian)
.                                 
.                                 recode raced (62
> 0=1) (100/610 630/997=0), gen(korean)
(79,154,500 differences between raced and korean)
.                                 
.                                 recode raced (64
> 0=1) (100/630 641/997=0), gen(vietnamese)
(79,154,500 differences between raced and vietname
> se)
.                                 
.                                 recode raced(500
> =1) (100/420 600/997=0), gen(japanese)
(79,154,500 differences between raced and japanese
> )
.                                 
.                                 recode race(2=1)
>  (1 3/9=0), gen(black)
(79,154,500 differences between race and black)
.                                 
.                                 //renter/owner
.                                 gen renter = 0
.                                 replace renter =
>  1 if inlist(ownershpd,21,22)
(21,668,168 real changes made)
. 
.         gen hotspot = 0
.         replace hotspot = 1 if inlist(city, 6290
> , 3020, 4930, 6810, 4610, 5430, 2870, 7000, 3730
> , 2390, 3020, 2490, 2430, 6330, 0190, 7230, 6030
> , 6430, 5750)
(3,319,028 real changes made)
.                                 
.                                 //variables that
>  we'll keep only for the head
.                                 replace metarea 
> = met2013 if year > 2011
variable metarea was int now long
(33,642,805 real changes made)
.                                         local he
> ad_vars "renter rent rentgrs valueh age chinese 
> japanese filipino indian korean vietnamese asian
>  black educ statefip metro metarea farm hhtype s
> ex builtyr builtyr2 bedrooms city yrimmig hotspo
> t"
.                                         //Have b
> een including the statefip and metarea variables
>  as they are in the control vector. Unsure how t
> o collapse to use them and make the code work.//
.                                         replace 
> metarea = met2013 if year > 2011
(0 real changes made)
.                                         foreach 
> v of local head_vars {
  2.                                              
>    
.                                                 
> replace `v' = . if pernum!=1 //only keep data fo
> r household head
  3.                                         }
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(11,540,267 real changes made, 11,540,267 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(34,855,446 real changes made, 34,855,446 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
(47,568,789 real changes made, 47,568,789 to missi
> ng)
variable statefip not found
r(111);
.                                 
.                                 
.                         /***********************
> ******************************************
>                         * Collpase to Household
>                         * For demographics, we t
> ake the head's characteristics
>                         ************************
> *****************************************/
.                                 
.                                 collapse (first)
>  `head_vars' (sum) inc* , by(year serial hhwt)
.                                 
.                                 keep if inctot>0
>  //only keep households with positive income
.                                 keep if year>=19
> 40 //no house values/rents in 1950
.                                 
.                                 replace rent = .
>  if !renter //rent only for renters
.                                 //replace rent =
>  . if rent<=0 //rent only if >0
.                                 
.                                 replace rentgrs 
> = . if !renter //rent only for renters
.                                 //replace rentgr
> s = . if rentgrs<=0 //rent only if >0
.                                 
.                                 replace valueh =
>  . if renter //house value only if not renter
.                                 //replace valueh
>  = . if valueh<=0 //house value only if >0
.                                                 
>                 
.                                 //keep if inlist
> (year,1960, 2019)
.                                 
.                                 save "`dataPath'
> /IPUMS-USA_Extension.dta", replace
.   }
