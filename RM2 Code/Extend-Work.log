
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      Stata 18.0
___/   /   /___/   /   /___/       BE—Basic Edition

 Statistics and Data Science       Copyright 1985-2023 StataCo
> rp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 7784
> 5 USA
                                   800-782-8272        https:/
> /www.stata.com
                                   979-696-4600        service
> @stata.com

Stata license: Single-user  perpetual
Serial number: 301806304604
  Licensed to: tate
               UGA

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.

. do Extend-Work.do 

. /*********************************
> * Tate Mason                     *
> * UNC Charlotte                  *
> * Extend-Work.do                 *
> *********************************/
. 
. /********************************
> * 1. Environment Setup          *
> ********************************/
.         #delimit cr
delimiter now cr
.         clear

.         clear all

.         set more off

.         cap log close

.         
.         //Data Paths
.         
.   local data "/Volumes/TD1/mason/housing/RM2-Data"

.         local output "/Volumes/TD1/mason/housing/output/"

.         
.         log using `output'/RM2_output.txt, replace
--------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/TD1/mason/housing/output//RM2_output.txt
  log type:  smcl
 opened on:  11 Aug 2025, 15:23:09

.         
.         local prepRaw = 0

.         local prepDec = 0

.         local prepDummies = 0

.         local prepDecDummies = 0

.         local gapReg = 0

.         local doGraph = 0

.         local gapGraph = 1

.         local tabReg = 0

.         local bwReg     = 0

.         
. /********************************
> * 2. Data Setup (Percentiles)   *
> ********************************/
.         if `prepRaw' {
.                         
.                         use "`data'/IPUMS-USA_Extension-corr
> ect.dta", clear
.                         
.                         keep if inlist(year,1980,1990,2000,2
> 010,2019)
.                 
.                         gen rent_inc = 100*rentgrs/(inctot/1
> 2) if inctot>0
.                         gen hval_inc = valueh/(inctot/12) if
>  inctot>0
.                         
.                         
.                         gen inc_month = inctot/12
.                         gen own100 = 100*(1-renter)
.                         
.                         //compute percentiles
.                         local vars "rentgrs valueh own100 in
> c_month"
.                         
.                         levelsof year, local(years)
.                         
.                         foreach v of local vars {
  2.                                 di "computing percentiles
>  for `v'..."
  3.                                 gen pctr_`v'=.
  4.                                 foreach y of local years 
> {
  5.                                         di "    year=`y'.
> .."
  6.                                         xtile pctr_`v'_`y
> ' = `v' [aw=hhwt] if year==`y', nq(100)
  7.                                         replace pctr_`v'=
> pctr_`v'_`y' if year==`y'
  8.                                 }
  9.                                 
.                                 
.                         }
.                         save "`data'/fig2data.dta", replace
.                 }

. /********************************
> * 2. Data Setup (Deciles)       *
> ********************************/
.         if `prepDec' {
.                 
.                 use "`data'/IPUMS-USA_Extension-correct.dta"
> , clear
.                         
.                         keep if inlist(year,1980,1990,2000,2
> 010,2019)
.                         
.                         
.                 
.                         gen rent_inc = 100*rentgrs/(inctot/1
> 2) if inctot>0
.                         gen hval_inc = valueh/(inctot/12) if
>  inctot>0
.                         
.                         
.                         gen inc_month = inctot/12
.                         gen own100 = 100*(1-renter)
.                 
.                         //compute deciles       
.                         local vars "rentgrs valueh own100 in
> c_month"
.                         
.                         levelsof year, local(years)
.                         
.                         foreach v of local vars {
  2.                                 di "computing deciles for
>  `v'..."
  3.                                 gen dec_`v'=.
  4.                                 foreach y of local years 
> {
  5.                                         di "    year=`y'.
> .."
  6.                                         xtile dec_`v'_`y'
>  = `v' [aw=hhwt] if year==`y', nq(10)
  7.                                         replace dec_`v'=d
> ec_`v'_`y' if year==`y'
  8.                                 }
  9.                                 
.                                 
.                         }
.                         
.                         
.                         save "`data'/tab1data.dta", replace
.         }

. /********************************
> * 3. Prep Dummies (Percentiles) *
> ********************************/               
.                 
. if `prepDummies' {
.                 
.                 use "`data'/fig2data.dta", clear
.                 
.                 
.                 local races "asian chinese japanese korean v
> ietnamese filipino indian black"
.                         levelsof pctr_inc_month, local(ps)
.                         foreach p of local ps {
  2.                                  
.                                 di "p=`p'"
  3.                                 //generate dummy for inco
> me ranks
.                                         gen _incr_p`p' = 0 i
> f pctr_inc_month!=.
  4.                                         replace _incr_p`p
> ' = 1 if pctr_inc_month==`p'
  5.                                 foreach r of local races 
> {
  6.                                         di "race=`r'..."
  7.                                 //generate interaction wi
> th race
.                                         gen _ia_`r'_incr_p`p
> ' = `r'*_incr_p`p'
  8.                                 
.                                 
.                                 }
  9.                 
.                         }
.                         
.                         
.                         save "`data'/fig2_reg_data.dta", rep
> lace
.                         
.                 }

. /********************************
> * 3. Prep Dummies (Deciles)     *
> ********************************/               
.                 
. if `prepDecDummies' {
.                 
.                 use "`data'/tab1data.dta", clear
.                 
.                         local races "asian chinese japanese 
> korean vietnamese filipino indian black"
.                 
.                         levelsof dec_inc_month, local(ds)
.                         foreach d of local ds {
  2.                                  
.                                 di "d=`d'"
  3.                                 //generate dummy for inco
> me ranks
.                                         gen _incr_d`d' = 0 i
> f dec_inc_month!=.
  4.                                         replace _incr_d`d
> ' = 1 if dec_inc_month==`d'
  5.                                 foreach r of local races 
> {
  6.                                         di "race =`r'"
  7.                                 //generate interaction wi
> th asian
.                                         gen _ia_`r'_incr_d`d
> ' = `r'*_incr_d`d'
  8.                                 
.                                 }
  9.                         }
.                         
.                         
.                         save "`data'/tab1_reg_data.dta", rep
> lace
.                         
.                 }

.                 
. 
. /********************************
> * 4. Gap Regressions            *
> ********************************/
. if `gapReg'{
.                 use "`data'/fig2_reg_data.dta", clear
.                 local races "asian chinese japanese korean v
> ietnamese filipino indian black"
.                 foreach r of local races {
  2.                 //create interactions
.                         gen _ia_`r'_y = `r'*pctr_inc_month
  3.                 
.                 //run regression for each year and outcome
.                         
.                         
.                         local vars "rentgrs valueh own100"
  4.                         local controls "educ age sex hhty
> pe farm metarea statefip hotspot yrimmig"
  5.                         local years "1980,1990,2000,2010,
> 2019"
  6.                         
.                         sum `controls'
  7.                 
.                         replace pctr_own100=own100 //this on
> e is a linear probability model (no rank necessary)
  8.                         levelsof year, local(years) //gra
> b available years
  9.                         foreach v of local vars {
 10.                                 gen `r'_rgap_`v'_p25=.
 11.                                 gen `r'_rgap_`v'_p50=.
 12.                                 gen `r'_rgap_`v'_p75=.
 13.                                 foreach y of local years 
> {
 14.                         
.                                         //run parametric reg
> ression (linear in income rank)
.                                                 reg pctr_`v'
>  pctr_inc_month `r' _ia_`r'_y `controls' [aw=hhwt] if year==
> `y', 
 15.                                         
.                                         //predice race gap a
> t various income ranks
.                                                 replace `r'_
> rgap_`v'_p25 = _b[`r'] + _b[_ia_`r'_y]*25 if year==`y'
 16.                                                 replace `
> r'_rgap_`v'_p50 = _b[`r'] + _b[_ia_`r'_y]*50 if year==`y'
 17.                                                 replace `
> r'_rgap_`v'_p75 = _b[`r'] + _b[_ia_`r'_y]*75 if year==`y'
 18.                                 }
 19.                                 
.                         }
 20.                 }
.                 save "`data'/graph_gap.dta", replace
.         }

. /********************************
> * 5. Graphing                   *
> ********************************/       
. if `doGraph' {
.         use "`data'/graph_gap.dta", clear
.         local races "asian chinese japanese korean vietnames
> e filipino indian black"
.         foreach r of local races {
  2.     preserve
  3.     //collapse saved coefficients by year
.       collapse `r'_rgap*, by(year)
  4.   
.     //plot saved coefficients
.       tsset year
  5.     
.     
.       graph drop _all
  6.   
.       local vars "rentgrs valueh own100"
  7.       foreach v of local vars {
  8.       
.         if "`v'"=="rentgrs" {
  9.           local ylab "`r'/Non-`r' Rent Rank Gap"
 10.         }
 11.         else if "`v'"=="valueh" {
 12.           local ylab "`r'/Non-`r' House Price Rank Gap"
 13.         }
 14.         else if "`v'"=="own100" {
 15.           local ylab "`r'/Non-`r' Ownership Gap (perc. pt
> .)"
 16.         }
 17.       
.       #delimit ;
delimiter now ;
.         tsline `r'_rgap_`v'_p25 `r'_rgap_`v'_p50 `r'_rgap_`v
> '_p75,
> 
>         lwidth(thin thick thin)
>         lpattern(dash solid solid)
> 
>         msymbol(circle diamond square)
>       
>         legend(ring(0) pos(5) col(1) region(style(none)) ord
> er(1 "25-th Perc. Inc. Rank" 2 "50-th Perc. Inc. Rank" 3 "75
> -th Perc. Inc. Rank"))
>       
>         xlabel(1980(10)2020, grid gstyle(major) glstyle(dot)
>  glcolor(black) glwidth(small))
>         ylabel(-20(5)20, grid gstyle(major) glstyle(dot) glc
> olor(black) glwidth(small))
>         yline(0,lcolor(black) lwidth(thin))
>       
>         ytitle("`ylab'")
>         xtitle("Year")
>       
>       
>         name(`r'_`v')
>       
>         ;
 18.       #delimit cr
delimiter now cr
.         graph export "`output'/`r'_extended_rgap_`v'.pdf", a
> s(pdf) name(`r'_`v') replace
 19.       }
 20.       restore
 21.     }
.   }

. 
. /********************************
> * 1980 Gap Graphics             *
> ********************************/
.         if `gapGraph' { 
.                 use "`data'/IPUMS-USA_Extension-correct.dta"
> , clear
.                 
.                 local races "asian chinese japanese korean v
> ietnamese indian filipino black"
.                 foreach r of local races{
  2.                         preserve
  3.                                 drop if year!=1980
  4.                                 
.                                 gen rent_inc = 100*rentgrs/(
> inctot/12) if inctot>0
  5.                                 gen hval_inc = valueh/(in
> ctot/12) if inctot>0
  6.                         
.                                 xtile rentp = rentgrs [aw=hh
> wt], nq(10)
  7.                                 xtile valuep = valueh [aw
> =hhwt], nq(10)
  8.                                 xtile incp = inctot [aw=h
> hwt], nq(10)
  9.                                 
.                                 gen `r'_b = incp if `r'==1
 10.                                 
.                                 reg rentp i.`r'_b
 11.                                 
.                                 //2a, 2c, 2e
.                                 
.                                 #delimit ;
delimiter now ;
.                                 binscatter rentp incp [aw=hh
> wt],
>                                 by(`r') nq(10)
>                                 linetype(qfit)
>         msymbol(circle diamond square)
>                                 name(`r'_Fig2a,replace)
>                                 title("Rent Rank Gap in 1980
> ")
>                                 ytitle("Rent Rank")
>                                 xtitle("Income Rank")
>                                 legend(ring(0) pos(1) col(1)
> )
>                                 ;
 12.                                 #delimit cr
delimiter now cr
.                                 graph export "`output'/`r'_2
> a.pdf", as(pdf) name(`r'_Fig2a) replace
 13.                                 
.                                 #delimit
delimiter now ;
.                                 binscatter valuep incp [aw=h
> hwt],
>                                 by(`r') nq(50)
>                                 linetype(qfit)
>         msymbol(circle diamond square)
>                                 name(`r'_Fig2c,replace)
>                                 title("House Price Rank Gap 
> in 1980")
>                                 ytitle("Price Rank")
>                                 xtitle("Income Rank")
>                                 legend (ring(0) pos(1) col(1
> ))
>                                 ;
 14.                                 #delimit cr
delimiter now cr
.                                 graph export "`output'/`r'_2
> c.pdf", as(pdf) name(`r'_Fig2c) replace
 15.                                 
.                                 gen own100 = 100*(1-renter)
 16.                                 
.                                 #delimit ;
delimiter now ;
.                                 binscatter own100 incp [aw=h
> hwt],
>                                 by(`r') nq(50)
>                                 linetype(qfit)
>         msymbol(circle diamond square)
>                                 name(`r'_Fig2e,replace)
>                                 title("Ownership Rate Gaps i
> n 1980")
>                                 ytitle("Ownership Rate")
>                                 xtitle("Income Rank")
>                                 legend (ring(0) pos(1) col(1
> ))
>                                 ;
 17.                                 #delimit cr
delimiter now cr
.                                 graph export "`output'/`r'_2
> e.pdf", as(pdf) name(`r'_Fig2e) replace
 18.                         restore 
 19.                 }
(30,675,965 observations deleted)
nquantiles() must be less than or equal to number of observati
> ons plus one
r(198);
.         }               
r(198);

end of do-file
r(198);
